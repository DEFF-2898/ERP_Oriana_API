openapi: 3.1.0
info:
  title: Oriana ERP - People API
  version: 1.1.0
  description: API para gestión de personas (core.person), detalles por tipo (core.natural_person, core.legal_entity), documentos
    (core.person_document) y representantes legales (core.legal_representative).
servers:
- url: /api/v1
tags:
- name: people
  description: Personas naturales y jurídicas.
- name: person-documents
  description: Documentos de identificación de una persona.
- name: legal-representatives
  description: Representantes legales de personas jurídicas.
security:
- bearerAuth: []
paths:
  /people:
    post:
      tags:
      - people
      operationId: createPerson
      summary: Crear persona
      description: Crea una nueva persona (natural o jurídica) junto con sus datos específicos según tipo.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PersonCreateRequest'
      responses:
        '201':
          description: Persona creada.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PersonResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalServerError'
    get:
      tags:
      - people
      operationId: listPeople
      summary: Listar personas
      description: Devuelve una lista de personas filtradas por tipo y/o criterio de búsqueda.
      parameters:
      - $ref: '#/components/parameters/PersonTypeQuery'
      - $ref: '#/components/parameters/SearchQuery'
      - $ref: '#/components/parameters/ActiveQuery'
      - $ref: '#/components/parameters/Limit'
      - $ref: '#/components/parameters/Offset'
      responses:
        '200':
          description: Listado de personas.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PersonListResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /people/{personId}:
    get:
      tags:
      - people
      operationId: getPerson
      summary: Obtener persona
      description: Devuelve el detalle completo de una persona, incluyendo datos asociados según su tipo.
      parameters:
      - $ref: '#/components/parameters/PersonId'
      responses:
        '200':
          description: Detalle de persona.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PersonResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    put:
      tags:
      - people
      operationId: updatePerson
      summary: Actualizar persona (reemplazo)
      description: Actualiza de forma completa una persona existente.
      parameters:
      - $ref: '#/components/parameters/PersonId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PersonUpdateRequest'
      responses:
        '200':
          description: Persona actualizada.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PersonResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalServerError'
    patch:
      tags:
      - people
      operationId: patchPerson
      summary: Actualizar persona (parcial)
      description: Actualiza parcialmente una persona (contacto, dirección, estado, etc.).
      parameters:
      - $ref: '#/components/parameters/PersonId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PersonPatchRequest'
      responses:
        '200':
          description: Persona actualizada.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PersonResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /people/{personId}/documents:
    get:
      tags:
      - person-documents
      operationId: listPersonDocuments
      summary: Listar documentos de la persona
      description: Devuelve el listado de documentos asociados a una persona.
      parameters:
      - $ref: '#/components/parameters/PersonId'
      - $ref: '#/components/parameters/ActiveQuery'
      responses:
        '200':
          description: Listado de documentos.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PersonDocumentListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    post:
      tags:
      - person-documents
      operationId: createPersonDocument
      summary: Crear documento
      description: Registra un nuevo documento de identificación para una persona. Existe unicidad por (documentType, documentNumber).
      parameters:
      - $ref: '#/components/parameters/PersonId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PersonDocumentCreateRequest'
      responses:
        '201':
          description: Documento creado.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PersonDocumentResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /people/{personId}/documents/{documentId}:
    put:
      tags:
      - person-documents
      operationId: updatePersonDocument
      summary: Actualizar documento (reemplazo)
      description: Actualiza completamente un documento existente asociado a una persona.
      parameters:
      - $ref: '#/components/parameters/PersonId'
      - $ref: '#/components/parameters/DocumentId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PersonDocumentUpdateRequest'
      responses:
        '200':
          description: Documento actualizado.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PersonDocumentResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalServerError'
    patch:
      tags:
      - person-documents
      operationId: patchPersonDocument
      summary: Actualizar documento (parcial)
      description: Actualiza parcialmente un documento (isActive, fechas, isPrimary).
      parameters:
      - $ref: '#/components/parameters/PersonId'
      - $ref: '#/components/parameters/DocumentId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PersonDocumentPatchRequest'
      responses:
        '200':
          description: Documento actualizado.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PersonDocumentResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /people/{personId}/documents/{documentId}/make-primary:
    post:
      tags:
      - person-documents
      operationId: makePrimaryDocument
      summary: Marcar documento como principal
      description: Marca un documento como principal para la persona, asegurando que no existan múltiples documentos principales
        activos.
      parameters:
      - $ref: '#/components/parameters/PersonId'
      - $ref: '#/components/parameters/DocumentId'
      responses:
        '200':
          description: Documento marcado como principal.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PersonDocumentResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /legal-entities/{legalEntityPersonId}/representatives:
    get:
      tags:
      - legal-representatives
      operationId: listLegalRepresentatives
      summary: Listar representantes legales
      description: Devuelve el listado de representantes legales asociados a una persona jurídica.
      parameters:
      - $ref: '#/components/parameters/LegalEntityPersonId'
      - $ref: '#/components/parameters/ActiveQuery'
      responses:
        '200':
          description: Listado de representantes.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LegalRepresentativeListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    post:
      tags:
      - legal-representatives
      operationId: createLegalRepresentative
      summary: Crear representante legal
      description: Vincula una persona natural existente como representante legal de una persona jurídica.
      parameters:
      - $ref: '#/components/parameters/LegalEntityPersonId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LegalRepresentativeCreateRequest'
      responses:
        '201':
          description: Representante creado.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LegalRepresentativeResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /legal-entities/{legalEntityPersonId}/representatives/{representativeId}/deactivate:
    patch:
      tags:
      - legal-representatives
      operationId: deactivateLegalRepresentative
      summary: Desactivar representante legal
      description: Desactiva la relación de representante legal, manteniendo historial. Generalmente marca isActive=false
        y puede setear endDate.
      parameters:
      - $ref: '#/components/parameters/LegalEntityPersonId'
      - $ref: '#/components/parameters/RepresentativeId'
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LegalRepresentativeDeactivateRequest'
      responses:
        '200':
          description: Representante desactivado.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LegalRepresentativeResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalServerError'
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  parameters:
    PersonId:
      name: personId
      in: path
      required: true
      schema:
        type: integer
        format: int64
        minimum: 1
    DocumentId:
      name: documentId
      in: path
      required: true
      schema:
        type: integer
        format: int64
        minimum: 1
    LegalEntityPersonId:
      name: legalEntityPersonId
      in: path
      required: true
      schema:
        type: integer
        format: int64
        minimum: 1
    RepresentativeId:
      name: representativeId
      in: path
      required: true
      schema:
        type: integer
        format: int64
        minimum: 1
    PersonTypeQuery:
      name: type
      in: query
      required: false
      schema:
        type: string
        enum: &id001
        - NATURAL
        - LEGAL
      description: Filtra por tipo de persona (catalog.person_type.code).
    SearchQuery:
      name: search
      in: query
      required: false
      schema:
        type: string
        maxLength: 150
      description: Búsqueda libre (por email, nombre, documento, etc. según implementación).
    ActiveQuery:
      name: active
      in: query
      required: false
      schema:
        type: boolean
      description: Filtra por is_active (true/false).
    Limit:
      name: limit
      in: query
      required: false
      schema:
        type: integer
        minimum: 1
        maximum: 200
        default: 50
    Offset:
      name: offset
      in: query
      required: false
      schema:
        type: integer
        minimum: 0
        default: 0
  schemas:
    PersonTypeCode:
      type: string
      enum: *id001
    GenderCode:
      type: string
      enum:
      - M
      - F
      - O
      - N
    DocumentTypeCode:
      type: string
      enum:
      - DNI
      - PASSPORT
      - CE
      - RUC
    PersonBase:
      type: object
      additionalProperties: false
      properties:
        personType:
          $ref: '#/components/schemas/PersonTypeCode'
        email:
          type: string
          format: email
          maxLength: 150
        secondaryEmail:
          type:
          - string
          - 'null'
          format: email
          maxLength: 150
        mobilePhone:
          type:
          - string
          - 'null'
          maxLength: 30
        landlinePhone:
          type:
          - string
          - 'null'
          maxLength: 30
        countryId:
          type: integer
          format: int32
          minimum: 1
        postalCode:
          type:
          - string
          - 'null'
          maxLength: 10
        primaryAddressLine:
          type: string
        primaryAddressLine2:
          type:
          - string
          - 'null'
      required:
      - personType
      - email
      - countryId
      - primaryAddressLine
    NaturalPersonData:
      type: object
      additionalProperties: false
      properties:
        name:
          type: string
          maxLength: 100
        firstSurname:
          type: string
          maxLength: 100
        secondSurname:
          type: string
          maxLength: 100
        birthDate:
          type: string
          format: date
        genderCode:
          $ref: '#/components/schemas/GenderCode'
      required:
      - name
      - firstSurname
      - secondSurname
      - birthDate
      - genderCode
    LegalEntityData:
      type: object
      additionalProperties: false
      properties:
        legalName:
          type: string
          maxLength: 150
        tradeName:
          type:
          - string
          - 'null'
          maxLength: 150
        foundationDate:
          type:
          - string
          - 'null'
          format: date
      required:
      - legalName
    PersonCreateRequest:
      allOf:
      - $ref: '#/components/schemas/PersonBase'
      - type: object
        additionalProperties: false
        properties:
          isActive:
            type: boolean
            default: true
          naturalPerson:
            $ref: '#/components/schemas/NaturalPersonData'
          legalEntity:
            $ref: '#/components/schemas/LegalEntityData'
        oneOf:
        - properties:
            personType:
              const: NATURAL
          required:
          - naturalPerson
        - properties:
            personType:
              const: LEGAL
          required:
          - legalEntity
    PersonUpdateRequest:
      allOf:
      - $ref: '#/components/schemas/PersonCreateRequest'
    PersonPatchRequest:
      type: object
      additionalProperties: false
      properties:
        isActive:
          type: boolean
        email:
          type: string
          format: email
          maxLength: 150
        secondaryEmail:
          type:
          - string
          - 'null'
          format: email
          maxLength: 150
        mobilePhone:
          type:
          - string
          - 'null'
          maxLength: 30
        landlinePhone:
          type:
          - string
          - 'null'
          maxLength: 30
        countryId:
          type: integer
          format: int32
          minimum: 1
        postalCode:
          type:
          - string
          - 'null'
          maxLength: 10
        primaryAddressLine:
          type: string
        primaryAddressLine2:
          type:
          - string
          - 'null'
        naturalPerson:
          $ref: '#/components/schemas/NaturalPersonData'
        legalEntity:
          $ref: '#/components/schemas/LegalEntityData'
      minProperties: 1
    PersonResponse:
      type: object
      additionalProperties: false
      properties:
        id:
          type: integer
          format: int64
        isActive:
          type: boolean
        personType:
          $ref: '#/components/schemas/PersonTypeCode'
        email:
          type: string
          format: email
        secondaryEmail:
          type:
          - string
          - 'null'
          format: email
        mobilePhone:
          type:
          - string
          - 'null'
        landlinePhone:
          type:
          - string
          - 'null'
        country:
          type: object
          additionalProperties: false
          properties:
            id:
              type: integer
              format: int32
            isoAlpha2:
              type:
              - string
              - 'null'
              maxLength: 2
            name:
              type: string
          required:
          - id
          - name
        postalCode:
          type:
          - string
          - 'null'
        primaryAddressLine:
          type: string
        primaryAddressLine2:
          type:
          - string
          - 'null'
        naturalPerson:
          type:
          - object
          - 'null'
          additionalProperties: false
          properties:
            name:
              type: string
            firstSurname:
              type: string
            secondSurname:
              type: string
            birthDate:
              type: string
              format: date
            gender:
              type: object
              additionalProperties: false
              properties:
                id:
                  type: integer
                  format: int32
                code:
                  $ref: '#/components/schemas/GenderCode'
                name:
                  type: string
              required:
              - id
              - code
              - name
          required:
          - name
          - firstSurname
          - secondSurname
          - birthDate
          - gender
        legalEntity:
          type:
          - object
          - 'null'
          additionalProperties: false
          properties:
            legalName:
              type: string
            tradeName:
              type:
              - string
              - 'null'
            foundationDate:
              type:
              - string
              - 'null'
              format: date
          required:
          - legalName
        createdBy:
          anyOf:
          - $ref: '#/components/schemas/UserAccountId'
          - type: 'null'
          readOnly: true
        createdAt:
          type: string
          format: date-time
          readOnly: true
        updatedBy:
          anyOf:
          - $ref: '#/components/schemas/UserAccountId'
          - type: 'null'
          readOnly: true
        updatedAt:
          type:
          - string
          - 'null'
          format: date-time
          readOnly: true
        deletedBy:
          anyOf:
          - $ref: '#/components/schemas/UserAccountId'
          - type: 'null'
          readOnly: true
        deletedAt:
          type:
          - string
          - 'null'
          format: date-time
          readOnly: true
      required:
      - id
      - isActive
      - personType
      - email
      - country
      - primaryAddressLine
      - createdAt
    PersonListResponse:
      type: object
      additionalProperties: false
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/PersonResponse'
        meta:
          $ref: '#/components/schemas/PaginationMeta'
      required:
      - items
      - meta
    PersonDocumentCreateRequest:
      type: object
      additionalProperties: false
      properties:
        documentTypeCode:
          $ref: '#/components/schemas/DocumentTypeCode'
        documentNumber:
          type: string
          maxLength: 30
        isPrimary:
          type: boolean
          default: false
        issuedDate:
          type:
          - string
          - 'null'
          format: date
        expirationDate:
          type:
          - string
          - 'null'
          format: date
        isActive:
          type: boolean
          default: true
      required:
      - documentTypeCode
      - documentNumber
    PersonDocumentUpdateRequest:
      allOf:
      - $ref: '#/components/schemas/PersonDocumentCreateRequest'
    PersonDocumentPatchRequest:
      type: object
      additionalProperties: false
      properties:
        isActive:
          type: boolean
        isPrimary:
          type: boolean
        issuedDate:
          type:
          - string
          - 'null'
          format: date
        expirationDate:
          type:
          - string
          - 'null'
          format: date
      minProperties: 1
    PersonDocumentResponse:
      type: object
      additionalProperties: false
      properties:
        id:
          type: integer
          format: int64
        isActive:
          type: boolean
        personId:
          type: integer
          format: int64
        documentType:
          type: object
          additionalProperties: false
          properties:
            id:
              type: integer
              format: int32
            code:
              $ref: '#/components/schemas/DocumentTypeCode'
            name:
              type: string
          required:
          - id
          - code
          - name
        documentNumber:
          type: string
        isPrimary:
          type: boolean
        issuedDate:
          type:
          - string
          - 'null'
          format: date
        expirationDate:
          type:
          - string
          - 'null'
          format: date
        createdAt:
          type: string
          format: date-time
          readOnly: true
        updatedAt:
          type:
          - string
          - 'null'
          format: date-time
          readOnly: true
        createdBy:
          anyOf:
          - $ref: '#/components/schemas/UserAccountId'
          readOnly: true
        updatedBy:
          anyOf:
          - $ref: '#/components/schemas/UserAccountId'
          - type: 'null'
          readOnly: true
      required:
      - id
      - isActive
      - personId
      - documentType
      - documentNumber
      - isPrimary
      - createdAt
    PersonDocumentListResponse:
      type: object
      additionalProperties: false
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/PersonDocumentResponse'
      required:
      - items
    LegalRepresentativeCreateRequest:
      type: object
      additionalProperties: false
      properties:
        naturalPersonId:
          type: integer
          format: int64
          minimum: 1
          description: core.natural_person.person_id
        jobPosition:
          type:
          - string
          - 'null'
          maxLength: 100
        startDate:
          type: string
          format: date
        endDate:
          type:
          - string
          - 'null'
          format: date
        isMain:
          type: boolean
          default: false
        isActive:
          type: boolean
          default: true
      required:
      - naturalPersonId
      - startDate
    LegalRepresentativeDeactivateRequest:
      type: object
      additionalProperties: false
      properties:
        endDate:
          type:
          - string
          - 'null'
          format: date
          description: 'Opcional: fecha fin de representación.'
        reason:
          type:
          - string
          - 'null'
          maxLength: 200
    LegalRepresentativeResponse:
      type: object
      additionalProperties: false
      properties:
        id:
          type: integer
          format: int64
        isActive:
          type: boolean
        legalEntityPersonId:
          type: integer
          format: int64
        naturalPersonId:
          type: integer
          format: int64
        jobPosition:
          type:
          - string
          - 'null'
        startDate:
          type: string
          format: date
        endDate:
          type:
          - string
          - 'null'
          format: date
        isMain:
          type: boolean
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type:
          - string
          - 'null'
          format: date-time
      required:
      - id
      - isActive
      - legalEntityPersonId
      - naturalPersonId
      - startDate
      - isMain
      - createdAt
    LegalRepresentativeListResponse:
      type: object
      additionalProperties: false
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/LegalRepresentativeResponse'
      required:
      - items
    PaginationMeta:
      type: object
      additionalProperties: false
      properties:
        limit:
          type: integer
          minimum: 1
        offset:
          type: integer
          minimum: 0
        total:
          type: integer
          minimum: 0
      required:
      - limit
      - offset
      - total
    ErrorResponse:
      type: object
      additionalProperties: false
      properties:
        code:
          type: string
        message:
          type: string
        details:
          type:
          - object
          - array
          - string
          - 'null'
      required:
      - code
      - message
    UserAccountId:
      type: integer
      format: int64
      minimum: 1
      description: security.user_account.id
  responses:
    BadRequest:
      description: Solicitud inválida.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Unauthorized:
      description: No autenticado/No autorizado.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    NotFound:
      description: Recurso no encontrado.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Conflict:
      description: Conflicto (p.ej. email único o documento duplicado).
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    InternalServerError:
      description: Error inesperado.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
