openapi: 3.1.0
info:
  title: Oriana ERP - Inventory API
  version: 1.1.0
  description: API de Inventario para gestión de tipos de habitación y habitaciones.
  contact:
    name: Oriana ERP
    email: support@oriana.hotel.erp
  license:
    name: Proprietary
servers:
  - url: /api/v1
tags:
  - name: room-types
    description: Gestión de tipos de habitación.
  - name: rooms
    description: Gestión de habitaciones de la propiedad.
security:
  - bearerAuth: []
paths:
  /room-types:
    get:
      tags:
        - room-types
      operationId: listRoomTypes
      summary: Listar tipos de habitación
      description: Devuelve el listado de tipos de habitación definidos para la propiedad.
      parameters:
        - $ref: "#/components/parameters/XPropertyId"
      responses:
        "200":
          description: Listado de tipos de habitación.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RoomTypeListResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"
    post:
      tags:
        - room-types
      operationId: createRoomType
      summary: Crear tipo de habitación
      description: Crea un nuevo tipo de habitación para la propiedad.
      parameters:
        - $ref: "#/components/parameters/XPropertyId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RoomTypeCreateRequest"
      responses:
        "201":
          description: Tipo de habitación creado.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RoomTypeResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"
  /room-types/{roomTypeId}:
    get:
      tags:
        - room-types
      operationId: getRoomType
      summary: Obtener tipo de habitación
      parameters:
        - $ref: "#/components/parameters/XPropertyId"
        - $ref: "#/components/parameters/RoomTypeId"
      responses:
        "200":
          description: Detalle del tipo de habitación.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RoomTypeResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"
    put:
      tags:
        - room-types
      operationId: updateRoomType
      summary: Actualizar tipo de habitación (reemplazo)
      parameters:
        - $ref: "#/components/parameters/XPropertyId"
        - $ref: "#/components/parameters/RoomTypeId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RoomTypeUpdateRequest"
      responses:
        "200":
          description: Tipo de habitación actualizado.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RoomTypeResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"
    patch:
      tags:
        - room-types
      operationId: patchRoomType
      summary: Actualizar tipo de habitación (parcial)
      parameters:
        - $ref: "#/components/parameters/XPropertyId"
        - $ref: "#/components/parameters/RoomTypeId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RoomTypePatchRequest"
      responses:
        "200":
          description: Tipo de habitación actualizado.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RoomTypeResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"
  /rooms:
    get:
      tags:
        - rooms
      operationId: listRooms
      summary: Listar habitaciones
      description: Devuelve el listado de habitaciones permitiendo filtrar por estado, piso o tipo.
      parameters:
        - $ref: "#/components/parameters/XPropertyId"
        - $ref: "#/components/parameters/RoomStatusQuery"
        - $ref: "#/components/parameters/FloorQuery"
        - $ref: "#/components/parameters/RoomTypeIdQuery"
        - $ref: "#/components/parameters/Limit"
        - $ref: "#/components/parameters/Offset"
      responses:
        "200":
          description: Listado de habitaciones.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RoomListResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"
    post:
      tags:
        - rooms
      operationId: createRoom
      summary: Crear habitación
      parameters:
        - $ref: "#/components/parameters/XPropertyId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RoomCreateRequest"
      responses:
        "201":
          description: Habitación creada.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RoomResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"
  /rooms/{roomId}:
    get:
      tags:
        - rooms
      operationId: getRoom
      summary: Obtener habitación
      parameters:
        - $ref: "#/components/parameters/XPropertyId"
        - $ref: "#/components/parameters/RoomId"
      responses:
        "200":
          description: Detalle de la habitación.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RoomResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"
    put:
      tags:
        - rooms
      operationId: updateRoom
      summary: Actualizar habitación (reemplazo)
      parameters:
        - $ref: "#/components/parameters/XPropertyId"
        - $ref: "#/components/parameters/RoomId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RoomUpdateRequest"
      responses:
        "200":
          description: Habitación actualizada.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RoomResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"
    patch:
      tags:
        - rooms
      operationId: patchRoom
      summary: Actualizar habitación (parcial)
      parameters:
        - $ref: "#/components/parameters/XPropertyId"
        - $ref: "#/components/parameters/RoomId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RoomPatchRequest"
      responses:
        "200":
          description: Habitación actualizada.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RoomResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"
  /rooms/{roomId}/status:
    patch:
      tags:
        - rooms
      operationId: updateRoomStatus
      summary: Actualizar estado de habitación
      description: Actualiza el estado operativo de una habitación junto con notas.
      parameters:
        - $ref: "#/components/parameters/XPropertyId"
        - $ref: "#/components/parameters/RoomId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RoomStatusUpdateRequest"
      responses:
        "200":
          description: Estado de habitación actualizado.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RoomResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  parameters:
    XPropertyId:
      name: X-Property-Id
      in: header
      required: true
      schema:
        type: integer
        format: int64
        minimum: 1
    RoomTypeId:
      name: roomTypeId
      in: path
      required: true
      schema:
        type: integer
        format: int32
        minimum: 1
    RoomId:
      name: roomId
      in: path
      required: true
      schema:
        type: integer
        format: int64
        minimum: 1
    RoomStatusQuery:
      name: statusCode
      in: query
      required: false
      schema:
        type: string
        enum: &id001
          - AVAILABLE
          - OCCUPIED
          - DIRTY
          - CLEANING
          - MAINTENANCE
          - OUT_OF_ORDER
    FloorQuery:
      name: floor
      in: query
      required: false
      schema:
        type: integer
        minimum: 0
    RoomTypeIdQuery:
      name: roomTypeId
      in: query
      required: false
      schema:
        type: integer
        format: int32
        minimum: 1
    Limit:
      name: limit
      in: query
      required: false
      schema:
        type: integer
        minimum: 1
        maximum: 200
        default: 50
    Offset:
      name: offset
      in: query
      required: false
      schema:
        type: integer
        minimum: 0
        default: 0
  schemas:
    RoomTypeCreateRequest:
      type: object
      additionalProperties: false
      properties:
        code:
          type: string
          maxLength: 20
        name:
          type: string
          maxLength: 100
        description:
          type:
            - string
            - "null"
        capacity:
          type: integer
          minimum: 1
        isActive:
          type: boolean
          default: true
      required:
        - code
        - name
        - capacity
    RoomTypeUpdateRequest:
      allOf:
        - $ref: "#/components/schemas/RoomTypeCreateRequest"
    RoomTypePatchRequest:
      type: object
      additionalProperties: false
      properties:
        name:
          type: string
          maxLength: 100
        description:
          type:
            - string
            - "null"
        capacity:
          type: integer
          minimum: 1
        isActive:
          type: boolean
      minProperties: 1
    RoomTypeResponse:
      type: object
      additionalProperties: false
      properties:
        id:
          type: integer
          format: int32
        propertyId:
          type: integer
          format: int64
        code:
          type: string
        name:
          type: string
        description:
          type:
            - string
            - "null"
        capacity:
          type: integer
        isActive:
          type: boolean
      required:
        - id
        - propertyId
        - code
        - name
        - capacity
        - isActive
    RoomTypeListResponse:
      type: object
      additionalProperties: false
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/RoomTypeResponse"
      required:
        - items
    RoomCreateRequest:
      type: object
      additionalProperties: false
      properties:
        roomTypeId:
          type: integer
          format: int32
          minimum: 1
        number:
          type: string
          maxLength: 20
        floor:
          type: integer
          minimum: 0
        statusCode:
          type: string
          enum: *id001
          default: AVAILABLE
        notes:
          type:
            - string
            - "null"
        isActive:
          type: boolean
          default: true
      required:
        - roomTypeId
        - number
        - floor
    RoomUpdateRequest:
      allOf:
        - $ref: "#/components/schemas/RoomCreateRequest"
    RoomPatchRequest:
      type: object
      additionalProperties: false
      properties:
        roomTypeId:
          type: integer
          format: int32
          minimum: 1
        number:
          type: string
          maxLength: 20
        floor:
          type: integer
          minimum: 0
        notes:
          type:
            - string
            - "null"
        isActive:
          type: boolean
      minProperties: 1
    RoomStatusUpdateRequest:
      type: object
      additionalProperties: false
      properties:
        statusCode:
          type: string
          enum: *id001
        notes:
          type:
            - string
            - "null"
      required:
        - statusCode
    RoomResponse:
      type: object
      additionalProperties: false
      properties:
        id:
          type: integer
          format: int64
        propertyId:
          type: integer
          format: int64
        roomTypeId:
          type: integer
          format: int32
        number:
          type: string
        floor:
          type: integer
        statusCode:
          type: string
          enum: *id001
        notes:
          type:
            - string
            - "null"
        isActive:
          type: boolean
      required:
        - id
        - propertyId
        - roomTypeId
        - number
        - floor
        - statusCode
        - isActive
    RoomListResponse:
      type: object
      additionalProperties: false
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/RoomResponse"
        meta:
          $ref: "#/components/schemas/PaginationMeta"
      required:
        - items
        - meta
    PaginationMeta:
      type: object
      additionalProperties: false
      properties:
        limit:
          type: integer
        offset:
          type: integer
        total:
          type: integer
      required:
        - limit
        - offset
        - total
    ErrorResponse:
      type: object
      additionalProperties: false
      properties:
        code:
          type: string
        message:
          type: string
        details:
          type:
            - object
            - array
            - string
            - "null"
      required:
        - code
        - message
  responses:
    BadRequest:
      description: Solicitud inválida.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    Unauthorized:
      description: No autorizado.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    NotFound:
      description: Recurso no encontrado.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    Conflict:
      description: Conflicto de negocio.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    InternalServerError:
      description: Error inesperado.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
