openapi: 3.1.0
info:
  title: Oriana ERP - Staff API
  version: 1.1.0
  description:
    API para gestión de empleados (staff.employee) y su historial de turnos (staff.employee_shift) y posiciones
    (staff.employee_position). Requiere header X-Property-Id.
servers:
  - url: /api/v1
tags:
  - name: employees
    description: Gestión de empleados de la propiedad.
  - name: employee-shifts
    description: Historial de asignación de turnos por empleado.
  - name: employee-positions
    description: Historial de asignación de posiciones/cargos por empleado.
security:
  - bearerAuth: []
paths:
  /employees:
    post:
      tags:
        - employees
      operationId: createEmployee
      summary: Registrar empleado
      description:
        Crea un nuevo empleado para la propiedad. Se asocia a una persona existente (core.person) y define datos
        laborales básicos.
      parameters:
        - $ref: "#/components/parameters/XPropertyId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/EmployeeCreateRequest"
      responses:
        "201":
          description: Empleado creado.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/EmployeeResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"
    get:
      tags:
        - employees
      operationId: listEmployees
      summary: Listar empleados
      description: Devuelve el listado de empleados de la propiedad. Permite filtrar por estado y departamento.
      parameters:
        - $ref: "#/components/parameters/XPropertyId"
        - $ref: "#/components/parameters/EmployeeStatusCode"
        - $ref: "#/components/parameters/DepartmentId"
        - name: active
          in: query
          required: false
          description: Filtra por is_active (registro activo/inactivo).
          schema:
            type: boolean
        - $ref: "#/components/parameters/Limit"
        - $ref: "#/components/parameters/Offset"
      responses:
        "200":
          description: Listado de empleados.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/EmployeeListResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/InternalServerError"
  /employees/{employeeId}:
    get:
      tags:
        - employees
      operationId: getEmployee
      summary: Obtener empleado
      description: Devuelve el detalle completo de un empleado específico.
      parameters:
        - $ref: "#/components/parameters/XPropertyId"
        - $ref: "#/components/parameters/EmployeeId"
      responses:
        "200":
          description: Detalle del empleado.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/EmployeeResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"
    put:
      tags:
        - employees
      operationId: updateEmployee
      summary: Actualizar empleado (reemplazo)
      description: Actualiza de forma completa un empleado existente, reemplazando los datos previamente registrados.
      parameters:
        - $ref: "#/components/parameters/XPropertyId"
        - $ref: "#/components/parameters/EmployeeId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/EmployeeUpdateRequest"
      responses:
        "200":
          description: Empleado actualizado.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/EmployeeResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"
    patch:
      tags:
        - employees
      operationId: patchEmployee
      summary: Actualizar empleado (parcial)
      description:
        Actualiza parcialmente un empleado. En particular, permite gestionar terminationDate, statusCode o isActive
        sin reemplazar el registro completo.
      parameters:
        - $ref: "#/components/parameters/XPropertyId"
        - $ref: "#/components/parameters/EmployeeId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/EmployeePatchRequest"
      responses:
        "200":
          description: Empleado actualizado.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/EmployeeResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"
  /employees/{employeeId}/shifts:
    get:
      tags:
        - employee-shifts
      operationId: listEmployeeShifts
      summary: Listar asignaciones de turno
      description: Devuelve el historial de asignación de turnos de un empleado (staff.employee_shift).
      parameters:
        - $ref: "#/components/parameters/XPropertyId"
        - $ref: "#/components/parameters/EmployeeId"
        - name: active
          in: query
          required: false
          description: Si true, solo devuelve la asignación vigente (endDate NULL o is_active true según implementación).
          schema:
            type: boolean
      responses:
        "200":
          description: Historial de turnos.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/EmployeeShiftListResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"
    post:
      tags:
        - employee-shifts
      operationId: assignEmployeeShift
      summary: Asignar turno (nueva asignación)
      description:
        Crea una nueva asignación de turno. El backend debe cerrar la asignación anterior (por ejemplo, seteando
        endDate) para mantener una sola asignación vigente.
      parameters:
        - $ref: "#/components/parameters/XPropertyId"
        - $ref: "#/components/parameters/EmployeeId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/EmployeeShiftCreateRequest"
      responses:
        "201":
          description: Asignación creada.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/EmployeeShiftResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"
  /employees/{employeeId}/positions:
    get:
      tags:
        - employee-positions
      operationId: listEmployeePositions
      summary: Listar asignaciones de posición/cargo
      description: Devuelve el historial de asignación de posiciones/cargos de un empleado (staff.employee_position).
      parameters:
        - $ref: "#/components/parameters/XPropertyId"
        - $ref: "#/components/parameters/EmployeeId"
        - name: active
          in: query
          required: false
          description: Si true, solo devuelve la asignación vigente.
          schema:
            type: boolean
      responses:
        "200":
          description: Historial de posiciones.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/EmployeePositionListResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"
    post:
      tags:
        - employee-positions
      operationId: assignEmployeePosition
      summary: Asignar posición/cargo (nueva asignación)
      description:
        Crea una nueva asignación de posición. El backend debe cerrar la asignación anterior para mantener una
        sola asignación vigente.
      parameters:
        - $ref: "#/components/parameters/XPropertyId"
        - $ref: "#/components/parameters/EmployeeId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/EmployeePositionCreateRequest"
      responses:
        "201":
          description: Asignación creada.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/EmployeePositionResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  parameters:
    XPropertyId:
      name: X-Property-Id
      in: header
      required: true
      description: Identificador de la propiedad (hotel.property.id).
      schema:
        type: integer
        format: int64
        minimum: 1
    EmployeeId:
      name: employeeId
      in: path
      required: true
      schema:
        type: integer
        format: int64
        minimum: 1
    EmployeeStatusCode:
      name: statusCode
      in: query
      required: false
      description: Filtro por estado del empleado (catalog.employee_status.code).
      schema:
        type: string
        enum: &id001
          - ACTIVE
          - INACTIVE
          - ON_LEAVE
          - SUSPENDED
          - TERMINATED
    DepartmentId:
      name: departmentId
      in: query
      required: false
      description: Filtro por departamento (catalog.department.id).
      schema:
        type: integer
        format: int32
        minimum: 1
    Limit:
      name: limit
      in: query
      required: false
      schema:
        type: integer
        minimum: 1
        maximum: 200
        default: 50
      description: Tamaño de página.
    Offset:
      name: offset
      in: query
      required: false
      schema:
        type: integer
        minimum: 0
        default: 0
      description: Desplazamiento para paginación.
  schemas:
    EmployeeStatusCode:
      type: string
      enum: *id001
      description: Estados definidos en catalog.employee_status.code.
    EmployeeCreateRequest:
      type: object
      additionalProperties: false
      properties:
        personId:
          type: integer
          format: int64
          minimum: 1
          description: core.person.id
        employeeCode:
          type: string
          maxLength: 30
        departmentId:
          type:
            - integer
            - "null"
          format: int32
          minimum: 1
        hireDate:
          type: string
          format: date
        terminationDate:
          type:
            - string
            - "null"
          format: date
          description: Debe ser >= hireDate si se envía.
        statusCode:
          $ref: "#/components/schemas/EmployeeStatusCode"
        contractTypeId:
          type: integer
          format: int32
          minimum: 1
          description: catalog.contract_type.id
      required:
        - personId
        - employeeCode
        - hireDate
        - statusCode
        - contractTypeId
    EmployeeUpdateRequest:
      allOf:
        - $ref: "#/components/schemas/EmployeeCreateRequest"
    EmployeePatchRequest:
      type: object
      additionalProperties: false
      properties:
        departmentId:
          type:
            - integer
            - "null"
          format: int32
          minimum: 1
        hireDate:
          type: string
          format: date
        terminationDate:
          type:
            - string
            - "null"
          format: date
        statusCode:
          $ref: "#/components/schemas/EmployeeStatusCode"
        contractTypeId:
          type: integer
          format: int32
          minimum: 1
        isActive:
          type: boolean
      minProperties: 1
    EmployeeResponse:
      type: object
      additionalProperties: false
      properties:
        id:
          type: integer
          format: int64
        propertyId:
          type: integer
          format: int64
        personId:
          type: integer
          format: int64
        employeeCode:
          type: string
          maxLength: 30
        departmentId:
          type:
            - integer
            - "null"
          format: int32
        hireDate:
          type: string
          format: date
        terminationDate:
          type:
            - string
            - "null"
          format: date
        status:
          type: object
          additionalProperties: false
          properties:
            id:
              type: integer
              format: int32
            code:
              $ref: "#/components/schemas/EmployeeStatusCode"
            name:
              type: string
          required:
            - id
            - code
        contractType:
          type: object
          additionalProperties: false
          properties:
            id:
              type: integer
              format: int32
            code:
              type: string
              maxLength: 20
            name:
              type: string
          required:
            - id
            - code
        isActive:
          type: boolean
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type:
            - string
            - "null"
          format: date-time
      required:
        - id
        - propertyId
        - personId
        - employeeCode
        - hireDate
        - status
        - contractType
        - isActive
        - createdAt
    EmployeeListResponse:
      type: object
      additionalProperties: false
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/EmployeeResponse"
        meta:
          $ref: "#/components/schemas/PaginationMeta"
      required:
        - items
        - meta
    EmployeeShiftCreateRequest:
      type: object
      additionalProperties: false
      properties:
        shiftId:
          type: integer
          format: int32
          minimum: 1
          description: catalog.shift.id
        startDate:
          type: string
          format: date
        endDate:
          type:
            - string
            - "null"
          format: date
          description: Normalmente omitido; el backend controla cierres de asignación.
        isActive:
          type: boolean
          default: true
      required:
        - shiftId
        - startDate
    EmployeeShiftResponse:
      type: object
      additionalProperties: false
      properties:
        id:
          type: integer
          format: int64
        propertyId:
          type: integer
          format: int64
        employeeId:
          type: integer
          format: int64
        shift:
          type: object
          additionalProperties: false
          properties:
            id:
              type: integer
              format: int32
            code:
              type: string
              maxLength: 10
            name:
              type: string
            startTime:
              type: string
              format: time
            endTime:
              type: string
              format: time
          required:
            - id
            - code
            - name
            - startTime
            - endTime
        startDate:
          type: string
          format: date
        endDate:
          type:
            - string
            - "null"
          format: date
        isActive:
          type: boolean
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type:
            - string
            - "null"
          format: date-time
      required:
        - id
        - propertyId
        - employeeId
        - shift
        - startDate
        - isActive
        - createdAt
    EmployeeShiftListResponse:
      type: object
      additionalProperties: false
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/EmployeeShiftResponse"
      required:
        - items
    EmployeePositionCreateRequest:
      type: object
      additionalProperties: false
      properties:
        positionId:
          type: integer
          format: int32
          minimum: 1
          description: catalog.job_position.id
        startDate:
          type: string
          format: date
        endDate:
          type:
            - string
            - "null"
          format: date
          description: Normalmente omitido; el backend controla cierres de asignación.
        notes:
          type:
            - string
            - "null"
        isActive:
          type: boolean
          default: true
      required:
        - positionId
        - startDate
    EmployeePositionResponse:
      type: object
      additionalProperties: false
      properties:
        id:
          type: integer
          format: int64
        propertyId:
          type: integer
          format: int64
        employeeId:
          type: integer
          format: int64
        position:
          type: object
          additionalProperties: false
          properties:
            id:
              type: integer
              format: int32
            code:
              type: string
              maxLength: 20
            name:
              type: string
            description:
              type:
                - string
                - "null"
          required:
            - id
            - code
            - name
        startDate:
          type: string
          format: date
        endDate:
          type:
            - string
            - "null"
          format: date
        notes:
          type:
            - string
            - "null"
        isActive:
          type: boolean
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type:
            - string
            - "null"
          format: date-time
      required:
        - id
        - propertyId
        - employeeId
        - position
        - startDate
        - isActive
        - createdAt
    EmployeePositionListResponse:
      type: object
      additionalProperties: false
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/EmployeePositionResponse"
      required:
        - items
    PaginationMeta:
      type: object
      additionalProperties: false
      properties:
        limit:
          type: integer
          minimum: 1
        offset:
          type: integer
          minimum: 0
        total:
          type: integer
          minimum: 0
      required:
        - limit
        - offset
        - total
    ErrorResponse:
      type: object
      additionalProperties: false
      properties:
        code:
          type: string
        message:
          type: string
        details:
          type:
            - object
            - array
            - string
            - "null"
      required:
        - code
        - message
  responses:
    BadRequest:
      description: Solicitud inválida.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    Unauthorized:
      description: No autenticado/No autorizado.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    NotFound:
      description: Recurso no encontrado.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    Conflict:
      description: Conflicto (por ejemplo, employee_code duplicado por propiedad o persona ya asociada).
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    InternalServerError:
      description: Error inesperado.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
